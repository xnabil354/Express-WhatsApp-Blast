<!DOCTYPE html>
<html>
  <head>
    <title>WhatsApp Blast - Home</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="text-center" style="background-color: #ffff">
    <div class="container-fluid">
      <div class="row justify-content-center align-items-center vh-100">
        <div
          class="col-12 col-md-6 form-signin"
          style="background-color: #303030; padding: 30px"
        >
          <h1 class="h5 mb-3 font-weight-normal text-white">WhatsApp Blast</h1>
          <img
            src="https://i.ibb.co/VTY0wDr/image.png"
            class="hero"
            width="250"
          />
          <div class="hero text-white" style="margin-top: 3px">
            Please Wait...
          </div>
          <img src="" alt="QR Code" id="qrcode" style="display: none" />
          <div class="row waForm" id="waForm" style="display: none">
            <div class="col-12">
              <div class="form-group">
                <textarea
                  class="form-control mb-3 border"
                  id="number"
                  name="number"
                  rows="5"
                  placeholder="Number List"
                ></textarea>
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <textarea
                  class="form-control mb-3 border"
                  id="message"
                  name="message"
                  rows="3"
                  placeholder="Your Message / Caption"
                ></textarea>
                <input
                  type="number"
                  class="form-control mb-3"
                  name="sleepTime"
                  id="sleepTime"
                  placeholder="Delay Message in Second: ( ex : 5 )"
                />
                <input
                  type="text"
                  class="form-control mb-3"
                  name="imageUrl"
                  id="imageUrl"
                  placeholder="Input Media from Url : ( image/video )"
                />
              </div>
            </div>
            <div class="col-12 mt-3">
              <button class="send-message-btn btn btn-danger w-100">
                Broadcast Now
              </button>
            </div>
          </div>
          <p class="mt-5 mb-3 text-muted text-white">
            X - ZhnDvs All || Rights Reserved &copy; 2023
          </p>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      $(document).ready(function () {
        var socket = io();

        socket.on("message", function (msg) {
          $(".logs").append($("<li>").text(msg));
        });

        socket.on("qr", function (src) {
          $("#qrcode").attr("src", src);
          $(".hero").hide();
          $("#qrcode").show();
        });

        socket.on("ready", function (data) {
          $("#qrcode").hide();
        });

        socket.on("authenticated", function (data) {
          $("h5").text("Fill your message and image link");
          $("#qrcode").hide();
          $(".hero").hide();
          $(".waForm").show();
        });

        socket.on("dump", function (data) {
          $("#number").val(data);
        });

        $(".send-message-btn").on("click", (e) => {
          e.preventDefault();
          let message = $("#message").val();
          let sleepTime = $("#sleepTime").val();
          let imageUrl = $("#imageUrl").val();
          let number = $("#number").val();
          let nomor = number.split("\n");
          if (imageUrl === "") {
            nomor.forEach((num, i) => {
              setTimeout(() => {
                $.post(
                  "/send-message",
                  {
                    number: num,
                    sleepTime: sleepTime,
                    message: message,
                  },
                  function (data) {
                    $(".logs").append($("<li>").text(data.status));
                  }
                );
              }, 1000);
              console.log(num);
              Swal.fire({
                icon: "success",
                title: "Message Sent",
                text: "Your message has been sent successfully!",
                confirmButtonColor: "#3085d6",
                confirmButtonText: "OK",
              })
                .then((result) => {
                  if (result.isConfirmed) {
                    $("#waForm :input").val("");
                  }
                })
                .catch((err) => {
                  console.log(err);
                });
            });
          } else {
            nomor.forEach((num, i) => {
              setTimeout(() => {
                $.post(
                  "/send-media",
                  {
                    number: num,
                    sleepTime: sleepTime,
                    caption: message,
                    file: imageUrl,
                  },
                  function (data) {
                    $(".logs").append($("<li>").text(data.status));
                  }
                );
              }, 1000);
              console.log(num);
              Swal.fire({
                icon: "success",
                title: "Message Sent",
                text: "Your message has been sent successfully!",
                confirmButtonColor: "#3085d6",
                confirmButtonText: "OK",
              })
                .then((result) => {
                  if (result.isConfirmed) {
                    $("#waForm :input").val("");
                  }
                })
                .catch((err) => {
                  console.log(err);
                });
            });
          }
        });
      });
    </script>
  </body>
</html>
